# stm32-swo
Отладка через SWO (Serial Wire Output) / ITM

Очень часто требуется выводить какой-то лог отладочных сообщений.
на Cortex-M0 (STM32F0XX) нет SWO, но вывод printf можно перенаправить на свободный USART TX 
(нужна только передача) подключить этот выход к переходнику COM2USB и
получить виртуальный порт, который можно открыть любым терминалом (например putty)
и в реальном режиме времени следить за выводом отладочных сообщений.
in putty Enable the "Implicit CR in every LF" option https://the.earth.li/~sgtatham/putty/0.60/htmldoc/Chapter4.html#i27
чтобы такая отладка не мешала - отправка идёт через прерывание из буфера, который выделяется под заполнение данными.
размер буфера подбирайте под интесивность вывода отладочных сообщений, чтобы не возникало его переполнений.

на большинстве остальных Cortex SWO (Serial Wire Output) / ITM включается в отладчике
и если есть поддержка JTAG адаптером, то достаточно перенаправить вывод printf используя ITM_SendChar
и скоростной вывод отладочной информации сразу видно в отладчике.
Но надо иметь в виду, что на дешёвых ST-Link китайского производства вывод SWO может (а чаще всего так и есть) отсутсвовать.
В оригинальных ST-LINK они есть.

Для использования в своих проектов возьмите только два файла serial_debug.c и serial_debug.h

и раскомментируйте куда необходимо писать отладочную информацию
//отладка пишет в USART
//#define COM_PORT_DEBUG

//отладка пишет в Serial Wire Debug (SWD)
//#define SWO_DEBUG

чтобы в GCC перенаправить вывод printf() необходимо добавить в ключи линкера
```
-specs=nosys.specs -specs=nano.specs
```
Если будет необходим вывод чисел с плавающей запятой, то нужно не забыть ключ
```
-u_printf_float

все остальные файлы демонстрационного проекта показывают вывод отладочной информации 
по прерыванию на свободный USART на примере st32f030